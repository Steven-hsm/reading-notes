# 详情


| 描述               | 例子                      | 前缀     | 尾缀               | 说明                      | 版本             |
| ------------------ | ------------------------- | -------- | ------------------ | ------------------------- | ---------------- |
| 卡券码             | 635475692996              | 无       | 无                 | 12位数字串                | 第一版           |
| 卡密生成           | drjncmtz                  | 无       | 无                 | 8位小写字母               | 卡密兑换卡券版本 |
| 扫码领取卡密       | CBHPBZYM3                 | C        | 8位字母数字组合    | C + 8位字母数字组合       | 扫码领卡券版本   |
| 红包活动卡密       | SB52YHMQF                 | S        | 8位字母数字组合    | S + 8位字母数字组         | 现金红包版本     |
| 特卖礼包活动       | act_4kOcUO0uryz           | act_     | 11位随机字母或数字 | act_11位随机字母或数字    | 第一版           |
| 店铺sn             | shop_SbtydpwVPas          | shop_    | 11位随机字母或数字 | shop_11位随机字母或数字   | 第一版           |
| 跟踪链接二维码     | qr_fJQO32UcgMH5m20NSFZBc3 | qr_      | 22位随机字母或数字 | qr_22位随机字母或数字     | 第一版           |
| 营销活动           | market_J7a1GMDwe          | market_  | 9位随机字母或数字  | qmarket_9位随机字母或数字 | 国庆版本         |
| 分类标签           | ctg_6Lvedbx7J4t3          | ctg_     | 12位随机字母或数字 | ctg_12位随机字母或数字    | 第一版           |
| 引导关注           | follow_Tb454S8nUGr        | follow_  | 11位随机字母       | ctg_11位随机字母字        | 关注引导         |
| 渠道编码           | channel_VQA3rS4UAvS       | channel_ | 11位随机字母       | channel_11位随机字母      | 渠道编码,渠道id  |
| 外置券导入券码链接 | UACBKJ123                 | U        | 8位字母数字组合    | U + 8位字母数字组合       | 自我游3期版本    |

# 一、卡密规则码

* 无规则的码    已投入使用，暂时不做改变
* 规则的码      后期对码做了规范，以 前缀字符 + 8位大写字母数字，例如CCB7AEYY2

## 1. 无规则的码
规则以产品定义为主

* 卡券码（第一版）

> 12位纯数字，不过以字符串方式存储(前面可以为0) 

> 例如：635475692996

> 生成表：card_code

* 卡密生成（卡密兑换卡券版本）

> 8位小写字母

> 例如：drjncmtz

> 生成表：card_secret_key


## 2. 规则的码
暂时定义为 前缀字母 + 八位字母组合

* 扫码领取卡密（扫码领卡券版本）

> 前缀字母：C

> 例如：CBHPBZYM3

> 生成表：scan_card_key

* 红包活动卡密（现金红包版本）

> 前缀字母：S

> 例如: SB52YHMQF

> 生成表：cash_voucher_code

* 外置券导入券码链接（自我游3期版本）

> 前缀字母：U

> 例如: UB52YHMQF

> 生成表：card_code

## 3. 生成码的算法规则

* 算法说明：

> 为了使生成对应的卡券唯一（可以不到数据库查询），需要维护一个索引数字，每次
> 都需要传入一个唯一索引值。

> 一般索引值从1开始，暂时的做法是存入数据库表sys_param中,每次生成一个卡密之后，索引值 + 1，批量生成可以在最后更新索引值，分布式系统的时候最好加锁，防止索引值冲突

> 上述方案可以生成唯一数字，如果需要生成字母类型的，使用进制转换即可

* 字母说明

> 为了避免用户输入时，不确定对应字母和数字，需要剔除部分数字和字母，例如1 0 I i O  o L 等

* 字母方案

产品可以根据需要增加或者剔除某些字母，或者使用新的组合

> 纯小写字母：new String[]{"a", "b", "c", "d", "e", "f", "g", "h","i", "j", "k","l", "m", "n","o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"};

> 大写字母+数字组合：new String[]{"A", "B", "C", "D", "E", "F", "G", "H", "J", "K", "M", "N", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z","2","3","4","5","6","7","8","9"};

* 代码说明
具体代码可以参考定时任务 
vip_core_task com.doyd.quartz.task.job.cardcode.ScanCardKeyGenerateJob

> 关键代码
```java
//生成12位纯数字串
String code = MakeNumUtils.generate11Num(SysParamKeyConsts.MAIN_KEY_SCAN_CARD_KEY, indexValue + i);
//将数字转换为具体的字母序列
String secret = BeanUtils.encode(Long.valueOf(code), BeanUtils.UPPER_CASE_AND_DIGIT);
```
# 二、其他类型识别码

## 特卖礼包活动相关

> act_ 前缀，后面为11位随机字母或数字

> 例如：act_4kOcUO0uryz

> 去重方案：数据库查询，重复取下一个

## 店铺sn

> shop_ 前缀 后面为11位随机字母

> 例如：shop_SbtydpwVPas

> 去重方案：以时间戳为依据算法生成，但是并不一定唯一，不唯一概率较小，数据库也有唯一索引。

## 跟踪链接二维码

> qr_ 前缀,后面为22位字母组合，采用md5加密取值方式

> 例如：qr_fJQO32UcgMH5m20NSFZBc3

> 去重方式，这里位数为22位，测试了一百万次生成没有重复，但是位数过短使用此方案会有重复问题，如果位数过短还是需要去重的

## 营销活动

> market_ 前缀，后面9为随机数字，方案同特卖礼包活动

> 例如：market_J7a1GMDwe

## 分类标签

> ctg_ 前缀，后面为 12位随机数，方案同跟踪链接二维码

> 例如：ctg_6Lvedbx7J4t3

## 引导关注

> follow_ 前缀,11位随机字母,方案同特卖礼包活动

> 例如：follow_Tb454S8nUGr

## 渠道编码
> channel_ 前缀,11位随机字符串
>
> 例如: channel_VQA3rS4UAvS