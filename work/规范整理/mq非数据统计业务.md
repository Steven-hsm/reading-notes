此文档主要是潮级vip非数据模块mq说明

# 1 卡券相关

## 1. 1 卡券核销

### mq发送条件

> 需要做后置处理类型的卡券被核销之后发送.
>
> 主要功能: 处理卡券核销之后的金额结算以及结算流水处理

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.card.off                                   |
| 队列(queue)                             | queue.card.off                                |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |
### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表   |
| -------- | -------- | ---------- | ------ | -------- |
| offId    | int      | 否         | 主键id | card_off |
## 1. 2 卡券核销撤销

### mq发送条件

> 卡券核销之后撤销,撤销需要走后置业务的流程.
>
> 主要功能: 核销结算回滚以及核销流水回滚

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.card.off.revoke                            |
| 队列(queue)                             | queue.card.off.revoke                         |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |
### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表           |
| -------- | -------- | ---------- | ------ | ---------------- |
| revokeId | int      | 否         | 主键id | shop_card_revoke |

## 1. 3 卡券售罄

### mq发送条件

> 门店卡券不足以领取
>
> 主要功能: 卡券售罄调用/legal-right/api/recharge/stock/{cardId:[\\d]+}接口处理

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.card.off.revoke                            |
| 队列(queue)                             | queue.card.off.revoke                         |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表       |
| -------- | -------- | ---------- | ------ | ------------ |
| cardId   | int      | 否         | 主键id | card_voucher |

# 2 活动相关

## 2. 1 活动卡券售罄

### mq发送条件

> 活动卡券领取之后没有库存
>
> 主要功能: 没有库存之后自动暂停活动

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.card.empty.act.offline                     |
| 队列(queue)                             | queue.card.empty.act.offline                  |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表   |
| -------- | -------- | ---------- | ------ | -------- |
| actId    | int      | 否         | 主键id | activity |

## 2. 2 普通活动结束

### mq发送条件

> 普通活动创建,编辑结束时间时发送
>
> 主要功能: 活动结束之后调用平台活动结束接口

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.act.end.delay                              |
| 队列(queue)                             | queue.act.end.delay                           |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表   |
| -------- | -------- | ---------- | ------ | -------- |
| actId    | int      | 否         | 主键id | activity |

## 2. 3 主题活动结束

### mq发送条件

> 主题活动创建,编辑结束时间时发送
>
> 主要功能: 主题活动结束之后后续处理

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.theme.act.end.delay                        |
| 队列(queue)                             | queue.theme.act.end.delay                     |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表           |
| -------- | -------- | ---------- | ------ | ---------------- |
| themeId  | int      | 否         | 主键id | theme_activities |

## 2. 4营销活动结束

### mq发送条件

> 营销活动创建,编辑结束时间时发送
>
> 主要功能: 营销活动结束之后后续处理

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.marketing.activity.end.delay               |
| 队列(queue)                             | queue.marketing.act.end.delay                 |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称    | 字段类型 | 是否可为空 | 说明   | 关联表             |
| ----------- | -------- | ---------- | ------ | ------------------ |
| marketActId | int      | 否         | 主键id | marketing_activity |

## 2. 5库存回收活动自动重启

### mq发送条件

> 库存回收时发送
>
> 主要功能: 库存回收之后重启因库存不足暂停的活动

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.recovery.stock                             |
| 队列(queue)                             | queue.recovery.stock.act.restart              |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 否                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表   |
| -------- | -------- | ---------- | ------ | -------- |
| actId    | int      | 否         | 主键id | activity |
## 2. 6惊喜配置库存回收活动自动重启

### mq发送条件

> 惊喜配置库存回收时发送
>
> 主要功能: 库存回收之后调用权益后台业务

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.surprise.card.stock.delay                  |
| 队列(queue)                             | queue.surprise.card.stock.delay               |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称   | 字段类型 | 是否可为空 | 说明   | 关联表                   |
| ---------- | -------- | ---------- | ------ | ------------------------ |
| cardPackSn | int      | 否         | 主键id | activity_surprise_config |

## 2. 7 组队领红包组团失败

### mq发送条件

> 组队领红包开团时发送
>
> 主要功能: 成团时间到了还没有成团,修改状态和数据

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.act.group.open                             |
| 队列(queue)                             | queue.act.group.open.failure                  |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表      |
| -------- | -------- | ---------- | ------ | ----------- |
| groupId  | int      | 否         | 主键id | grass_group |

## 2. 8 组队领红包未成团提醒

### mq发送条件

> 组队领红包开团时发送
>
> 主要功能: 结束拼团前一段时间还没有成团提醒

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.act.group.open.remind                      |
| 队列(queue)                             | queue.act.group.open.remind                   |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表      |
| -------- | -------- | ---------- | ------ | ----------- |
| groupId  | int      | 否         | 主键id | grass_group |

## 2. 9 红包券活动结束

### mq发送条件

> 红包券活动创建,编辑结束时间时发送
>
> 主要功能: 结束拼团前一段时间还没有成团提醒

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.cash.act.end.delay                         |
| 队列(queue)                             | queue.cash.act.end                            |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称  | 字段类型 | 是否可为空 | 说明   | 关联表        |
| --------- | -------- | ---------- | ------ | ------------- |
| cashActId | int      | 否         | 主键id | cash_activity |

## 2. 10 霸王餐活动开奖

### mq发送条件

> 霸王餐活动创建,编辑结束时间时发送
>
> 主要功能: 霸王餐开奖给用户分配奖品

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.dash.act.lottery.delay                     |
| 队列(queue)                             | queue.dash.act.lottery.delay                  |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表   |
| -------- | -------- | ---------- | ------ | -------- |
| actId    | int      | 否         | 主键id | activity |

## 2. 11 拼团活动结束

### mq发送条件

> 拼团活动创建,编辑结束时间时发送
>
> 主要功能: 拼团活动结束后置业务处理

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.act.assemble.end                           |
| 队列(queue)                             | queue.act.assemble.end                        |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表          |
| -------- | -------- | ---------- | ------ | --------------- |
| groupId  | int      | 否         | 主键id | assemble_group\ |

## 2. 12 拼团自动成团

### mq发送条件

> 拼团活动创建,编辑结束时间时发送
>
> 主要功能: 拼团时间到但未成团,自动成团

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.act.assemble.auto.group                    |
| 队列(queue)                             | queue.act.assemble.auto.group                 |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表         |
| -------- | -------- | ---------- | ------ | -------------- |
| groupId  | int      | 否         | 主键id | assemble_group |

## 2. 13 拼团开奖

### mq发送条件

> 拼团活动创建,编辑结束时间时发送
>
> 主要功能: 拼团开奖,调用开奖服务

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.act.assemble.draw                          |
| 队列(queue)                             | queue.act.assemble.draw                       |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 否                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表         |
| -------- | -------- | ---------- | ------ | -------------- |
| groupId  | int      | 否         | 主键id | assemble_group |

## 2. 14 拼团活动结束回收库存

### mq发送条件

> 拼团活动创建,编辑结束时间时发送
>
> 主要功能: 拼团活动结束回收库存

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.act.assemble.stop                          |
| 队列(queue)                             | queue.act.assemble.stop                       |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 是                                            |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表         |
| -------- | -------- | ---------- | ------ | -------------- |
| groupId  | int      | 否         | 主键id | assemble_group |



# 3订单相关

## 3. 1 取消订单

### mq发送条件

> 用户准备提交订单,还未支付时发送
>
> 主要功能: 15分钟未支付订单取消订单

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.order.cancel.delay                         |
| 队列(queue)                             | queue.order.cancel.delay                      |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表 |
| -------- | -------- | ---------- | ------ | ------ |
| orderId  | int      | 否         | 主键id | orders |

## 3. 2 订单支付提醒

### mq发送条件

> 用户准备提交订单,还未支付时发送
>
> 主要功能: 用户未支付订单,一段时间后提醒用户支付

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.order.cancel.remind.delay                  |
| 队列(queue)                             | queue.order.cancel.remind.delay               |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表 |
| -------- | -------- | ---------- | ------ | ------ |
| orderId  | int      | 否         | 主键id | orders |

## 3. 3 买单返现

### mq发送条件

> 买单之后,需要返现的记录
>
> 主要功能: 一段时间后,用户未退款,给用户返现金额

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.buy.cash.back.delay                        |
| 队列(queue)                             | queue.buy.cash.back.delay                     |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表          |
| -------- | -------- | ---------- | ------ | --------------- |
| ocId     | int      | 否         | 主键id | order_cash_back |

## 3. 4 特约商家解约,特卖活动退款

### mq发送条件

> 特约商家解约
>
> 主要功能: 特约商家解约之后后置业务处理

### mq说明

| 注意事项                                | 说明                                          |
| --------------------------------------- | --------------------------------------------- |
| 交换机(exchange)                        | ex.shop.terminate.success                     |
| 队列(queue)                             | queue.order.act.special.refund                |
| 路由键(routeKey)                        | 扇形交换机(fanout,这个参数是否填写不影响结果) |
| 队列类型(是否延迟队列)                  | 非延迟队列                                    |
| 是否插入mq操作记录表(mq_operate_record) | 是,发送mq是放此表的主键                       |

### data参数说明

| 字段名称 | 字段类型 | 是否可为空 | 说明   | 关联表          |
| -------- | -------- | ---------- | ------ | --------------- |
| ocId     | int      | 否         | 主键id | order_cash_back |

